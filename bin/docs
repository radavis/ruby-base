#!/usr/bin/env bash
#
# Documentation Service

set -Eeuo pipefail

image="ruby-docs"
container="ruby-docs"
target="docs"
port=2999

build() {
  # docker build [OPTIONS] PATH | URL | -
  docker build \
    --tag ${image} \
    --target ${target} \
    .
}

up() {
  # docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
  docker run \
    --rm \
    --name ${container} \
    -p "${port}:8808" \
    ${image}
}

down() {
  docker stop ${container} || true
  docker rm ${container} || true
}

logs() { docker logs --follow ${container}; }
help() { echo "Usage: bin/docs --build|up|down|logs"; }

opts="$*"
[[ $opts =~ "--build" ]] && build
[[ $opts =~ "--up" ]] && up
[[ $opts =~ "--down" ]] && down
[[ $opts =~ "--logs" ]] && logs
[[ -z $opts || $opts =~ "--help" ]] && help && exit 1
